{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yimeng/Documents/fish/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yimeng/Documents/fish/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/yimeng/Documents/fish/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/yimeng/Documents/fish/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/yimeng/Documents/fish/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/yimeng/Documents/fish/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'semantic-ui-css/semantic.min.css';import{Transition,Icon,Container,Radio,Form,Input,Message}from'semantic-ui-react';// import moment from 'moment'\nimport axios from'axios';import{bS}from'../BabyTalk';import{gS}from'../gSession';var WeatherDisplay=/*#__PURE__*/function(_React$Component){_inherits(WeatherDisplay,_React$Component);var _super=_createSuper(WeatherDisplay);function WeatherDisplay(){var _this;_classCallCheck(this,WeatherDisplay);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={displayC:false};return _this;}_createClass(WeatherDisplay,[{key:\"switchTemp\",value:function switchTemp(e){e.preventDefault();this.setState({displayC:!this.state.displayC});}},{key:\"render\",value:function render(){var W=this.props.w;var K=273.15;var weatherIconId=W.weather[0].icon;var wIILen=weatherIconId.length;var lastChar=W.weather[0].icon.charAt(wIILen-1);var weatherCond=W.weather[0].id;var dayNight=lastChar=='n'?\"night-\":\"day-\";var dayLight=dayNight=='day-';var iconName=\"wi wi-owm-\"+dayNight+weatherCond;var bgColor=\"white\";var fgColor='orange';if(!dayLight){bgColor='darkblue';fgColor='white';}function KtoC(t){return(t-K).toFixed(1);}function KtoF(t){return(KtoC(t)*9/5+32).toFixed(1);}var iconStyle={color:fgColor,fontSize:'40px',backgroundColor:bgColor,//width : '30%',\nheight:'100%',textAlign:'center',paddingTop:'30px',paddingBottom:'30px',paddingLeft:'5%',paddingRight:'5%',marginTop:\"8px\",marginBottom:\"5px\"};var windStyle={color:'blue'};var curTempStyle={color:\"#FFA233\",fontSize:\"40px\",fontFamily:\"sans-serif\",fontWeight:\"bold\",marginTop:\"10px\",paddingLeft:'5%',paddingRight:'5%'};var mTempStyle={color:\"teal\",fontSize:\"18px\"};var curTemp=this.state.displayC?KtoC(W.main.temp):KtoF(W.main.temp);var maxTemp=this.state.displayC?KtoC(W.main.temp_max):KtoF(W.main.temp_max);var minTemp=this.state.displayC?KtoC(W.main.temp_min):KtoF(W.main.temp_min);var degC=\"\\u2103\";var degF=\"\\u2109\";var degrees=this.state.displayC?degC:degF;var windDeg=W.wind.deg;var windIconName=\"wi wi-wind from-\".concat(windDeg,\"-deg\");return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Container,{textAlign:\"right\"},/*#__PURE__*/React.createElement(Radio,{slider:true,checked:this.state.displayC==false,onClick:this.switchTemp.bind(this)})),this.props.containerWidth,/*#__PURE__*/React.createElement(\"div\",{style:curTempStyle},curTemp,degrees,\" \",/*#__PURE__*/React.createElement(\"i\",{className:iconName,style:iconStyle}),/*#__PURE__*/React.createElement(\"i\",{className:windIconName,style:(iconStyle,windStyle)})),\"max \",/*#__PURE__*/React.createElement(\"span\",{style:mTempStyle},maxTemp,degrees),\"\\xA0\\xA0 min \",/*#__PURE__*/React.createElement(\"span\",{style:mTempStyle},minTemp,degrees));}}]);return WeatherDisplay;}(React.Component);var Weather=/*#__PURE__*/function(_React$Component2){_inherits(Weather,_React$Component2);var _super2=_createSuper(Weather);function Weather(){var _this2;_classCallCheck(this,Weather);for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}_this2=_super2.call.apply(_super2,[this].concat(args));_this2.state={title:'Weather',titleColor:'pink',owMapKey:'fe0e998401ffc6a75006eb0735e315d8',wData:null,loadSearch:false,zipcode:\"\",zipCodeError:false,messageHidden:true,refreshColor:'grey',refreshSeq:0,loading:false,cityID:null,weatherCity:null,inputVisible:false};return _this2;}_createClass(Weather,[{key:\"updateWeather\",value:function(){var _updateWeather=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(wdata){var cityData,data,foo,state,city,aData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:this.setState({wData:wdata});// get the lat, long from wdata, and look for the lat/long from mongodb, mongodb send back city, state/county info\n// we send lat, long to babyserver\n//console.log(wdata)\ncityData={userName:this.props.curUser.name,lat:wdata.coord.lat,lon:wdata.coord.lon};_context.next=4;return bS.post(\"/getCityInfo\",cityData);case 4:data=_context.sent;if(data){_context.next=11;break;}console.log(\"babyserver laid an egg\");this.props.setError(true);return _context.abrupt(\"return\");case 11:this.props.setError(false);case 12:foo=\"https://api.openweathermap.org/data/2.5/onecall?lat=\".concat(wdata.coord.lat,\"&lon=\").concat(wdata.coord.lon,\"&exclude={current,minutely,hourly,alerts}&appid=\").concat(this.state.owMapKey,\"&units=metric\");//http://api.openweathermap.org/data/2.5/weather?id=${cityID}&appid=${this.state.owMapKey}`\naxios.get(foo).then(function(res){//console.log(res.data)\n});state=data.state?data.state:data.country;city=wdata.name+\", \"+state;this.setState({weatherCity:city});this.setState({cityID:data.id});aData={cityID:data.id};gS.setAppData(this.props.gridID,this.props.rIndex,this.props.cIndex,aData);this.props.setTitle(city,this.state.titleColor);this.setState({inputVisible:false});case 22:case\"end\":return _context.stop();}}},_callee,this);}));function updateWeather(_x){return _updateWeather.apply(this,arguments);}return updateWeather;}()},{key:\"inputValid\",value:function inputValid(e){if(this.state.zipcode==\"\"){this.setState({zipCodeError:true});}}},{key:\"inputTimeOut\",value:function inputTimeOut(e){this.setState({zipCodeError:false});}},{key:\"getAPIWeather\",value:function getAPIWeather(cityID){var _this3=this;var zURL=\"http://api.openweathermap.org/data/2.5/weather?zip=\".concat(this.state.zipcode,\"&appid=\").concat(this.state.owMapKey);var cURL=\"http://api.openweathermap.org/data/2.5/weather?q=\".concat(this.state.zipcode,\"&appid=\").concat(this.state.owMapKey);var wURL=parseInt(this.state.zipcode)?zURL:cURL;if(parseInt(cityID)){//console.log(this.state.cityID)\n//console.log(cityID)\nwURL=\"http://api.openweathermap.org/data/2.5/weather?id=\".concat(cityID,\"&appid=\").concat(this.state.owMapKey);}axios.get(wURL).then(function(res){_this3.updateWeather(res.data);_this3.setState({loadSearch:false});}).catch(function(error){if(error&&_this3.state.zipcode!==\"\"){_this3.setState({messageHidden:false});}});}},{key:\"getWeather\",value:function(){var _getWeather=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:this.getAPIWeather(true);case 1:case\"end\":return _context2.stop();}}},_callee2,this);}));function getWeather(){return _getWeather.apply(this,arguments);}return getWeather;}()},{key:\"handleChange\",value:function handleChange(e){this.setState({messageHidden:true});this.setState({zipCodeError:false});this.setState({zipcode:e.target.value});}},{key:\"handleSubmit\",value:function handleSubmit(e){e.preventDefault();this.inputValid(e);setTimeout(this.inputTimeOut.bind(this),3000);this.setState({loadSearch:true});this.getWeather();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(oldProps){if(oldProps.triggerRefresh<this.props.triggerRefresh){this.refreshWeather();}}},{key:\"componentDidMount\",value:function componentDidMount(){this.props.setTitle(this.state.title,this.state.titleColor);this.props.noMenu(false);this.props.setError(false);this.props.setRefresh(\"grey\",false);var appData=gS.getAppData(this.props.gridID,this.props.rIndex,this.props.cIndex);var inputCity=false;if(appData&&appData.cityID){inputCity=appData.cityID;}if(inputCity){this.setState({cityID:inputCity});this.getAPIWeather(inputCity);}}},{key:\"refreshWeather\",value:function refreshWeather(){this.props.setRefresh(\"red\",true);this.updateTitleColor('orange');this.getAPIWeather(false);this.setState({loading:true});setTimeout(this.resetRefreshColor.bind(this),3000);}},{key:\"resetRefreshColor\",value:function resetRefreshColor(){this.updateTitleColor(this.state.titleColor);this.props.setRefresh(\"grey\",false);}},{key:\"updateTitleColor\",value:function updateTitleColor(c){this.props.setTitle(this.state.weatherCity,c);}},{key:\"weatherInput\",value:function weatherInput(){return/*#__PURE__*/React.createElement(Form,{onSubmit:this.handleSubmit.bind(this)},/*#__PURE__*/React.createElement(Input,{action:{icon:'search',loading:false,onClick:this.handleSubmit.bind(this)},placeholder:\"Zip Code or City Name\",value:this.state.zipcode,onChange:this.handleChange.bind(this),error:this.state.zipCodeError}),/*#__PURE__*/React.createElement(Message,{hidden:this.state.messageHidden,error:true},\"Location not found.\"));}},{key:\"showInput\",value:function showInput(){this.setState({inputVisible:!this.state.inputVisible});}},{key:\"showWeather\",value:function showWeather(){return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(WeatherDisplay,{w:this.state.wData}),/*#__PURE__*/React.createElement(Container,{textAlign:\"right\"},/*#__PURE__*/React.createElement(Icon,{name:\"cog\",onClick:this.showInput.bind(this),color:\"grey\"}),/*#__PURE__*/React.createElement(Transition,{visible:this.state.inputVisible,animation:\"scale\",duration:500},this.weatherInput())));}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",null,this.state.wData?this.showWeather():this.weatherInput());}}]);return Weather;}(React.Component);export default Weather;","map":{"version":3,"sources":["/Users/yimeng/Documents/fish/src/components/Weather.js"],"names":["React","Transition","Icon","Container","Radio","Form","Input","Message","axios","bS","gS","WeatherDisplay","state","displayC","e","preventDefault","setState","W","props","w","K","weatherIconId","weather","icon","wIILen","length","lastChar","charAt","weatherCond","id","dayNight","dayLight","iconName","bgColor","fgColor","KtoC","t","toFixed","KtoF","iconStyle","color","fontSize","backgroundColor","height","textAlign","paddingTop","paddingBottom","paddingLeft","paddingRight","marginTop","marginBottom","windStyle","curTempStyle","fontFamily","fontWeight","mTempStyle","curTemp","main","temp","maxTemp","temp_max","minTemp","temp_min","degC","degF","degrees","windDeg","wind","deg","windIconName","switchTemp","bind","containerWidth","Component","Weather","title","titleColor","owMapKey","wData","loadSearch","zipcode","zipCodeError","messageHidden","refreshColor","refreshSeq","loading","cityID","weatherCity","inputVisible","wdata","cityData","userName","curUser","name","lat","coord","lon","post","data","console","log","setError","foo","get","then","res","country","city","aData","setAppData","gridID","rIndex","cIndex","setTitle","zURL","cURL","wURL","parseInt","updateWeather","catch","error","getAPIWeather","target","value","inputValid","setTimeout","inputTimeOut","getWeather","oldProps","triggerRefresh","refreshWeather","noMenu","setRefresh","appData","getAppData","inputCity","updateTitleColor","resetRefreshColor","c","handleSubmit","onClick","handleChange","showInput","weatherInput","showWeather"],"mappings":"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","sourcesContent":["import React from 'react'\nimport 'semantic-ui-css/semantic.min.css'\nimport {Transition, Icon, Container, Radio, Form, Input, Message} from 'semantic-ui-react'\n// import moment from 'moment'\nimport axios from 'axios'\nimport {bS} from '../BabyTalk'\nimport {gS} from '../gSession'\n\n\n\nclass WeatherDisplay extends React.Component{\n\n    state = {\n\tdisplayC : false,\n    }\n\t\n\tswitchTemp(e){\n\t    e.preventDefault()\n\t    this.setState({displayC : !this.state.displayC})\n\t}\n\n    render(){\n\tlet W = this.props.w\n\tlet K = 273.15\n\tlet weatherIconId = W.weather[0].icon\n\tlet wIILen =  weatherIconId.length\n\tlet lastChar = W.weather[0].icon.charAt(wIILen - 1);\n\tlet weatherCond = W.weather[0].id\n\tlet dayNight = lastChar == 'n' ? \"night-\": \"day-\"\n\n\tlet dayLight = dayNight == 'day-'\n\t\n\tlet iconName = \"wi wi-owm-\"+dayNight+weatherCond\n\t\n\tlet bgColor = \"white\"\n\tlet fgColor = 'orange' \n\tif (!dayLight){\n\t    bgColor = 'darkblue'\n\t    fgColor = 'white'\n\t}\n\n\tfunction KtoC(t){\n\t    return (t - K).toFixed(1)\n\t}\n\n\tfunction KtoF(t){\n\t    return (((KtoC(t) * 9)/5)+32).toFixed(1)\n\t}\n\n\t\n\n\tlet iconStyle = {\n\t    color : fgColor,\n\t    fontSize: '40px',\n\t    backgroundColor: bgColor,\n\t    //width : '30%',\n\t    height : '100%',\n\n\t    textAlign : 'center', \n\t    paddingTop: '30px',\n\t    paddingBottom: '30px',\n\t    paddingLeft: '5%',\n\t    paddingRight: '5%', \n\t    marginTop: \"8px\",\n\t    marginBottom: \"5px\"\n\t}\n\n\tlet windStyle = {\n\t    color : 'blue',\n\t}\n\n\t\n\tlet curTempStyle ={\n\t    color: \"#FFA233\",\n\t    fontSize: \"40px\",\n\t    fontFamily:\"sans-serif\",\n\t    fontWeight:\"bold\",\n\t    marginTop:\"10px\",\n\t    paddingLeft: '5%',\n\t    paddingRight: '5%',\n\t}\n\tlet mTempStyle={\n\t\tcolor: \"teal\", fontSize: \"18px\"\n\t}\n\n\tlet curTemp = this.state.displayC ? KtoC(W.main.temp) : KtoF(W.main.temp)\n\tlet maxTemp = this.state.displayC ? KtoC(W.main.temp_max) : KtoF(W.main.temp_max)\n\tlet minTemp = this.state.displayC ? KtoC(W.main.temp_min) : KtoF(W.main.temp_min)\n\n\tlet degC = \"\\u2103\"\n\tlet degF = \"\\u2109\"\n\n\tlet degrees = this.state.displayC ? degC : degF\n\tlet windDeg = W.wind.deg\n\tlet windIconName = `wi wi-wind from-${windDeg}-deg`\n\treturn (\n \n\t\t<div>\n\t\t<Container textAlign='right'>\n\t\t<Radio slider checked={this.state.displayC == false} onClick={this.switchTemp.bind(this)}/>\n\t\t</Container>\n\t\t{this.props.containerWidth}\n\n\t\t<div style={curTempStyle}>{curTemp}{degrees} <i className={iconName} style={iconStyle}></i>\n\t    \t<i className={windIconName} style={iconStyle, windStyle}/></div>\n\t\tmax <span style={mTempStyle}>{maxTemp}{degrees}</span>&nbsp;&nbsp;\n\t    min <span style={mTempStyle}>{minTemp}{degrees}</span>\n\t    </div>\n\t)\n    }\n}\n\n\nclass Weather  extends React.Component{\n\n    state = {\n\ttitle : 'Weather',\n\ttitleColor : 'pink',\n\n\towMapKey: 'fe0e998401ffc6a75006eb0735e315d8',\n\twData : null,\n\tloadSearch: false,\n\tzipcode: \"\",\n\tzipCodeError: false,\n\tmessageHidden: true,\n\trefreshColor : 'grey',\n\trefreshSeq : 0,\n\tloading: false,\n\n\t\n\tcityID : null,\n\tweatherCity : null,\n\tinputVisible: false,\n    }\n\n\n    async updateWeather(wdata){\n\tthis.setState({wData : wdata})\n\t// get the lat, long from wdata, and look for the lat/long from mongodb, mongodb send back city, state/county info\n\t// we send lat, long to babyserver\n\t//console.log(wdata)\n\tvar cityData = {\n\t\tuserName: this.props.curUser.name,\n\t\tlat: wdata.coord.lat,\n\t\tlon: wdata.coord.lon,\n\t}\n\t\n\tvar data = await bS.post(\"/getCityInfo\", cityData)\n\n\tif (!data){\n\t    console.log(\"babyserver laid an egg\")\n\t    this.props.setError(true)\n\t    return;\n\t}\n\telse{\n\t    this.props.setError(false)\n\t}\n\n\n\n\tvar foo = `https://api.openweathermap.org/data/2.5/onecall?lat=${wdata.coord.lat}&lon=${wdata.coord.lon}&exclude={current,minutely,hourly,alerts}&appid=${this.state.owMapKey}&units=metric`\n\n    //http://api.openweathermap.org/data/2.5/weather?id=${cityID}&appid=${this.state.owMapKey}`\n\n\n\taxios.get(foo)\n\t    .then(res => {\n\t\t//console.log(res.data)\n\t    })\n\n\t\n\tvar state = data.state ?  data.state : data.country\n\t\n\tvar city = wdata.name + \", \" + state\n\tthis.setState({weatherCity : city})\n\tthis.setState({cityID : data.id})\n\tvar aData = {\n\t\tcityID : data.id\n\t}\n\tgS.setAppData(this.props.gridID,\n\t\tthis.props.rIndex,\n\t\tthis.props.cIndex, \n\t\taData)\n\n\tthis.props.setTitle(city, this.state.titleColor)\n\tthis.setState({inputVisible: false})\n    }\n\n    inputValid(e){\n\tif (this.state.zipcode == \"\"){\n\t    this.setState({zipCodeError: true})\n\t}\n    }\n\n    inputTimeOut(e){\n\tthis.setState({zipCodeError: false})\n    }\n\n\n    getAPIWeather(cityID){\n\n\tvar zURL =\n\t    `http://api.openweathermap.org/data/2.5/weather?zip=${this.state.zipcode}&appid=${this.state.owMapKey}`\n\tvar cURL =\n\t    `http://api.openweathermap.org/data/2.5/weather?q=${this.state.zipcode}&appid=${this.state.owMapKey}`\n\n\tvar wURL = parseInt(this.state.zipcode) ? zURL : cURL\n\n\tif (parseInt(cityID)){\n\t    //console.log(this.state.cityID)\n\t    //console.log(cityID)\n\t    wURL =\n\t\t`http://api.openweathermap.org/data/2.5/weather?id=${cityID}&appid=${this.state.owMapKey}`\n\t}\n\n\taxios.get(wURL)\n\t    .then(res => {\n\t\tthis.updateWeather(res.data)\n\t\tthis.setState({loadSearch: false})\n\t    })\n\t    .catch(error => {\n\t\tif (error && this.state.zipcode !== \"\"){\n\t\t    this.setState({messageHidden: false})\n\t\t}\n\t    })\n    }\n    \n    \n    async getWeather(){\n\tthis.getAPIWeather(true)\n    }\n\n    handleChange(e){\n\tthis.setState({messageHidden: true})\n\tthis.setState({zipCodeError: false})\n\tthis.setState({zipcode: e.target.value})\n    }\n\n    handleSubmit(e){\n\te.preventDefault();\n\tthis.inputValid(e)\n\tsetTimeout(this.inputTimeOut.bind(this), 3000)\n\tthis.setState({loadSearch: true})\n\tthis.getWeather()\n    }\n\n    componentDidUpdate(oldProps){\n\tif (oldProps.triggerRefresh < this.props.triggerRefresh){\n\t    this.refreshWeather()\n\t}\n    }\n\t\n    componentDidMount(){\n\tthis.props.setTitle(this.state.title, this.state.titleColor)\n\tthis.props.noMenu(false)\n\tthis.props.setError(false)\n\tthis.props.setRefresh(\"grey\", false)\n\n\tvar appData = gS.getAppData(this.props.gridID,\n\t\t      this.props.rIndex,\n\t\t      this.props.cIndex)\n\n\n\tvar inputCity = false;\n\tif (appData && appData.cityID) {\n\t inputCity = appData.cityID;   \n\t}\n\n\tif (inputCity){\n\t    this.setState({cityID : inputCity})\n\t    this.getAPIWeather(inputCity)\n\t}\n\t\n    }\n    \n    refreshWeather(){\n\tthis.props.setRefresh(\"red\", true)\n\tthis.updateTitleColor('orange')\n\tthis.getAPIWeather(false)\n\tthis.setState({loading: true})\n\tsetTimeout(this.resetRefreshColor.bind(this), 3000)\n    }\n\n\n    resetRefreshColor(){\n\tthis.updateTitleColor(this.state.titleColor)\n\tthis.props.setRefresh(\"grey\", false)    \n    }\n    \n    updateTitleColor(c){\n\tthis.props.setTitle(this.state.weatherCity, c)\n    }\n\t\t\n    weatherInput(){\n\treturn (\n\t    \t<Form onSubmit={this.handleSubmit.bind(this)}>\n\t\t<Input action={{ icon: 'search', loading: false, onClick : this.handleSubmit.bind(this)}} \n\t    placeholder='Zip Code or City Name' value={this.state.zipcode} \n\t    onChange={this.handleChange.bind(this)}\n\t    error={this.state.zipCodeError}\n\t\t/>\n\t\t<Message hidden={this.state.messageHidden} error={true}>\n\t\tLocation not found.\n\t\t</Message> \n\n\t    </Form>\n\n\t)\n    }\n\n    showInput(){\n\tthis.setState({inputVisible: !this.state.inputVisible})\n    }\n\n    showWeather(){\n\treturn (\n\t    <div>\n\t\t<WeatherDisplay w={this.state.wData}\n\t    \n\t\t/>\n\t\t<Container textAlign=\"right\">\n\t\t<Icon name='cog' onClick={this.showInput.bind(this)} color='grey'/>\n\t\t<Transition visible={this.state.inputVisible} animation='scale' duration={500}>\n\t\t{this.weatherInput()}\n\t        </Transition>\n\t\t</Container>\n\t\t</div>\n\t)\n    }\n    \n    render(){\n\treturn(\n\t\t<div>\n\t\t\n\t    {this.state.wData ?  this.showWeather():\n\t     this.weatherInput()}\n\t    \n\n\t\t</div>\n\t)\n    }\n}\n\nexport default Weather;\n"]},"metadata":{},"sourceType":"module"}