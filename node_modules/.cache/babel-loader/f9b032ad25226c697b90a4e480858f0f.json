{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yimeng/Documents/fish/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yimeng/Documents/fish/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/yimeng/Documents/fish/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/yimeng/Documents/fish/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/yimeng/Documents/fish/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/yimeng/Documents/fish/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import'semantic-ui-css/semantic.min.css';import{Header,Grid,Icon,Item,List}from'semantic-ui-react';import moment from'moment';import{bS}from'../BabyTalk';var EventList=/*#__PURE__*/function(_Component){_inherits(EventList,_Component);var _super=_createSuper(EventList);function EventList(){var _this;_classCallCheck(this,EventList);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={title:'Fish Events',events:[],eventSeq:0,headerColor:'blue',refreshColor:'grey',refreshSeq:0};return _this;}_createClass(EventList,[{key:\"processEventList\",value:function processEventList(events){this.setState({events:events});}},{key:\"findEventsById\",value:function findEventsById(id){var event=this.state.events.filter(function(ev){return ev.id===id;});return event[0];}},{key:\"editEvent\",value:function editEvent(rE,_ref){var name=_ref.name,value=_ref.value;console.log(\"edit\");console.log(value);console.log(this.findEventsById(value));}},{key:\"modifyEventStatus\",value:function(){var _modifyEventStatus=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(eid){var delData,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:delData={userName:this.props.curUser.name,eventID:eid};_context.next=3;return bS.post('/deleteEvent',delData);case 3:data=_context.sent;if(data){this.props.updateFishState(\"updateEvents\",this.props.appState.updateEvents+1);}else{this.props.setError(true);console.log(\"babyserver laid an egg\");}// update the event list\n//this.getEvents();\ncase 5:case\"end\":return _context.stop();}}},_callee,this);}));function modifyEventStatus(_x){return _modifyEventStatus.apply(this,arguments);}return modifyEventStatus;}()},{key:\"deleteEvent\",value:function deleteEvent(rE,_ref2){var name=_ref2.name,value=_ref2.value;this.modifyEventStatus(value);}},{key:\"EventDisplay\",value:function EventDisplay(ev){var a=new Date(ev.time*1000);var time=moment(a).format('LLL');var duration=moment.duration(ev.duration,\"minutes\").humanize();var loc=ev.location?\"at \"+ev.location:\"\";var disabled=ev.status===0;if(disabled){return\"\";}return/*#__PURE__*/React.createElement(List.Item,{key:ev.id},/*#__PURE__*/React.createElement(Item,null,/*#__PURE__*/React.createElement(Item.Content,null,/*#__PURE__*/React.createElement(Item.Header,null,/*#__PURE__*/React.createElement(Grid,{columns:2},/*#__PURE__*/React.createElement(Grid.Column,null,/*#__PURE__*/React.createElement(Header,{color:\"teal\",content:ev.event_name,disabled:disabled})),/*#__PURE__*/React.createElement(Grid.Column,{textAlign:\"right\"},!disabled&&/*#__PURE__*/React.createElement(Icon,{name:\"edit\",size:\"small\",color:\"grey\",value:ev.id,onClick:this.editEvent.bind(this),disabled:disabled}),!disabled&&/*#__PURE__*/React.createElement(Icon,{name:\"delete\",size:\"small\",color:\"grey\",value:ev.id,onClick:this.deleteEvent.bind(this),disabled:disabled})))),/*#__PURE__*/React.createElement(Item.Meta,null,time+\" \"+\"(\"+duration+\") \"+loc,\" \"),/*#__PURE__*/React.createElement(Item.Description,null,ev.detail))));}},{key:\"getEvents\",value:function(){var _getEvents=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return bS.post(\"/getAllEvents\",{userName:this.props.curUser.name});case 2:data=_context2.sent;// waits until await has completed\nif(data){this.processEventList(data);}else{this.props.setError(true);console.log(\"babyserver laid an egg\");}case 4:case\"end\":return _context2.stop();}}},_callee2,this);}));function getEvents(){return _getEvents.apply(this,arguments);}return getEvents;}()},{key:\"updateTitleColor\",value:function updateTitleColor(c){this.props.setTitle(this.state.title,c);}},{key:\"checkEventUpdate\",value:function checkEventUpdate(){if(!this.props.appState.updateEvents){this.props.updateFishState(\"updateEvents\",0);}if(this.props.appState.updateEvents>this.state.eventSeq){this.refreshEvents();this.setState({eventSeq:this.props.appState.updateEvents});}else{//console.log(\"event list unchanged\")\n//this.setState({headerColor: 'orange'})\n//setTimeout(this.updateEventList.bind(this), 50);\n}}},{key:\"componentDidUpdate\",value:function componentDidUpdate(oldProps){if(oldProps.triggerRefresh<this.props.triggerRefresh){this.setState({refreshSeq:this.props.triggerRefresh});this.refreshEvents();}}},{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.props.noMenu(false);this.props.setError(false);this.props.setTitle(this.state.title,this.state.headerColor);this.refreshEvents();this.timer=setInterval(function(){return _this2.checkEventUpdate();},1000);this.props.setRefresh(\"grey\",false);this.setState({refreshSeq:this.props.triggerRefresh});}},{key:\"resetRefreshColor\",value:function resetRefreshColor(){this.updateTitleColor(\"grey\");this.props.setRefresh(\"grey\",false);}},{key:\"refreshEvents\",value:function refreshEvents(){this.props.setRefresh(\"red\",true);this.updateTitleColor('orange');this.getEvents();setTimeout(this.resetRefreshColor.bind(this),3000);}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(List,{animated:true},this.state.events.map(function(ev){return _this3.EventDisplay(ev);})// call eventDisplay on every element of state.events\n));}}]);return EventList;}(Component);export default EventList;","map":{"version":3,"sources":["/Users/yimeng/Documents/fish/src/components/EventList.js"],"names":["React","Component","Header","Grid","Icon","Item","List","moment","bS","EventList","state","title","events","eventSeq","headerColor","refreshColor","refreshSeq","setState","id","event","filter","ev","rE","name","value","console","log","findEventsById","eid","delData","userName","props","curUser","eventID","post","data","updateFishState","appState","updateEvents","setError","modifyEventStatus","a","Date","time","format","duration","humanize","loc","location","disabled","status","event_name","editEvent","bind","deleteEvent","detail","processEventList","c","setTitle","refreshEvents","oldProps","triggerRefresh","noMenu","timer","setInterval","checkEventUpdate","setRefresh","updateTitleColor","getEvents","setTimeout","resetRefreshColor","map","EventDisplay"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport 'semantic-ui-css/semantic.min.css'\nimport { Header, Grid, Icon, Item, List } from 'semantic-ui-react'\nimport moment from 'moment'\nimport {bS} from '../BabyTalk'\n\nclass EventList extends Component{\n\n    state = {\n\ttitle : 'Fish Events',\n\tevents : [],\n\teventSeq : 0,\n\theaderColor : 'blue',\n\trefreshColor : 'grey',\n\trefreshSeq : 0\n    }\n    \n\n    processEventList(events){\n\tthis.setState({events : events})\n    }\n\n    findEventsById(id){\n\tlet event= this.state.events.filter(ev => ev.id === id)\n\treturn event[0]\n    }\n\n\n    editEvent(rE, {name, value}){\n\tconsole.log(\"edit\")\n\tconsole.log(value)\n\tconsole.log(this.findEventsById(value))\n    }\n\n    async modifyEventStatus(eid){\n\n\tlet delData = {\n\t    userName   : this.props.curUser.name,\n\t    eventID : eid\n\t}\n\n\t\t\n\tlet data = await bS.post('/deleteEvent', delData)\n\n\n\tif (data){\n\t    this.props.updateFishState(\"updateEvents\", this.props.appState.updateEvents +1)\n\t}\n\telse{\n\t    this.props.setError(true);\n\t    console.log(\"babyserver laid an egg\");\n       }\n\n\n\t// update the event list\n\t\n\t//this.getEvents();\n\t\n    }\n    \n    deleteEvent(rE, {name, value}){\n\tthis.modifyEventStatus(value)\n\t\n\t\n    }\n\n    EventDisplay(ev){\n\n\tvar a = new Date(ev.time * 1000);\n\tvar time = moment(a).format('LLL')\n\tvar duration = moment.duration(ev.duration, \"minutes\").humanize()\n\tvar loc = ev.location? \"at \" + ev.location : \"\"\n\tvar disabled = (ev.status === 0)\n\tif (disabled){\n\t    return (\"\")\n\t}\n  \n\treturn (  <List.Item key = {ev.id} >\n\t\t  <Item >\n\t\t  \n\t\t  <Item.Content >\n\t\t  <Item.Header>\n\t\t  <Grid columns = {2}>\n\t\t  <Grid.Column >\n\t\t  <Header color='teal' content={ev.event_name} disabled={disabled}/>\n\t\t  </Grid.Column>\n\t\t  <Grid.Column textAlign='right'>\n\t\t  {!disabled && <Icon name = 'edit' size = 'small' color='grey' value={ev.id}\n\t\t  onClick={this.editEvent.bind(this)}\n\t\t   disabled={disabled}/>}\n\t\t  {!disabled && <Icon name = 'delete' size = 'small' color='grey' value={ev.id}\n\t\t   onClick={this.deleteEvent.bind(this)}\n\t\t   disabled={disabled}/>}\n\t\t  </Grid.Column>\n\t\t  </Grid>\n\t\t  </Item.Header>\n\t\t  <Item.Meta>{time  + \" \" + \"(\" + duration + \") \" + loc } </Item.Meta>\n\t\t  <Item.Description>\n\t\t  {ev.detail}\n\t\t  </Item.Description>\n\t\t  </Item.Content>\n\t\t  </Item>\n\t\t  \n\t\t  </List.Item>)\n    }\n\n   async  getEvents(){\n       var data = await bS.post(\n           \"/getAllEvents\", {\n\t       userName: this.props.curUser.name,\n\t   })\n       // waits until await has completed\n\n       if (data){\n\t   this.processEventList(data)\n       }\n       else{\n\t   this.props.setError(true);\n\t   console.log(\"babyserver laid an egg\")\n       }\n   }\n\n\n    updateTitleColor(c){\n\tthis.props.setTitle(this.state.title, c)\n    }\n\n    checkEventUpdate(){\n\t\n\tif (!this.props.appState.updateEvents){\n\t    this.props.updateFishState(\"updateEvents\", 0)\n\t}\n\t\n\tif (this.props.appState.updateEvents > this.state.eventSeq){\n\t\tthis.refreshEvents()\n\t    this.setState({eventSeq : this.props.appState.updateEvents})\n\t}\n\telse{\n\t    //console.log(\"event list unchanged\")\n\t    //this.setState({headerColor: 'orange'})\n\t    //setTimeout(this.updateEventList.bind(this), 50);\n\t}\n    }\n\n    componentDidUpdate(oldProps){\n\tif (oldProps.triggerRefresh < this.props.triggerRefresh){\n\t    this.setState({refreshSeq : this.props.triggerRefresh})\n\t    this.refreshEvents()\n\t}\n    }\n\n    componentDidMount(){\n\tthis.props.noMenu(false)\n\tthis.props.setError(false);\n\tthis.props.setTitle(this.state.title, this.state.headerColor)\n\tthis.refreshEvents();\n\n\tthis.timer = setInterval(()=> this.checkEventUpdate(), 1000)\n\tthis.props.setRefresh(\"grey\", false)\n\tthis.setState({refreshSeq : this.props.triggerRefresh})\n    }\n\n    resetRefreshColor(){\n\tthis.updateTitleColor(\"grey\")\n\tthis.props.setRefresh(\"grey\", false)    \n}\n\n    refreshEvents(){\n\tthis.props.setRefresh(\"red\", true)\n\tthis.updateTitleColor('orange')\n\tthis.getEvents()\n\tsetTimeout(this.resetRefreshColor.bind(this), 3000)\n    }\n    \n    \n    render(){\n      \t\treturn(\n\n\t\t<div>\n\t\t\t<List animated={true}>\n\t\t{\n\t\t    this.state.events.map((ev) => this.EventDisplay(ev))\n\t\t // call eventDisplay on every element of state.events\n\t\t}\n \t\t</List>\n               </div>\n\t)\n    }\n}\n\nexport default EventList;\n\n"]},"metadata":{},"sourceType":"module"}